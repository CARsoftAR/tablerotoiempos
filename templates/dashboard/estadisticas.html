{% extends 'base.html' %}

{% block title %}Estadísticas Avanzadas{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    
    <!-- Top Bar & Filters -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-6">
        <div>
            <h1 class="text-3xl font-black text-white flex items-center gap-4 uppercase tracking-tighter">
                <div class="w-14 h-14 rounded-2xl bg-amber-400 text-black flex items-center justify-center shadow-[0_0_20px_rgba(251,191,36,0.5)]">
                    <i class="fas fa-chart-line text-2xl"></i>
                </div>
                ANALÍTICAS <span class="text-amber-400">GOLD</span>
            </h1>
            <p class="text-slate-400 mt-2 font-black uppercase tracking-widest text-[10px]">Inteligencia Operativa & Predicción</p>
        </div>
        
        <!-- Actions -->
        <div class="flex items-center gap-4">
            <button id="btnFullScreen" class="px-5 py-2.5 bg-white/5 hover:bg-white/10 text-white rounded-xl font-black uppercase tracking-widest text-[10px] border border-white/10 transition-all flex items-center gap-2" title="Pantalla Completa">
                <i class="fas fa-expand text-amber-400"></i>
                <span class="hidden sm:inline">Modo Hub</span>
            </button>

            <!-- Date Selector -->
            <form method="get" class="flex bg-white/5 p-1.5 rounded-xl border border-white/5 shadow-inner">
                <button type="submit" name="period" value="7" class="px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all {% if period == 7 %}bg-amber-400 text-black shadow-lg{% else %}text-slate-400 hover:text-white hover:bg-white/5{% endif %}">
                    07 Días
                </button>
                <button type="submit" name="period" value="15" class="px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all {% if period == 15 %}bg-amber-400 text-black shadow-lg{% else %}text-slate-400 hover:text-white hover:bg-white/5{% endif %}">
                    15 Días
                </button>
                <button type="submit" name="period" value="30" class="px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all {% if period == 30 %}bg-amber-400 text-black shadow-lg{% else %}text-slate-400 hover:text-white hover:bg-white/5{% endif %}">
                    30 Días
                </button>
            </form>
        </div>
    </div>

    <!-- OEE Trend Chart (HERO) -->
    <div class="glass-card rounded-2xl border border-white/5 shadow-2xl overflow-hidden mb-8">
        <div class="p-8 border-b border-white/5 flex justify-between items-center bg-white/[0.02]">
            <div>
                <h3 class="text-xs font-black text-slate-400 mb-1 uppercase tracking-[0.3em] flex items-center gap-3">
                    <span class="w-1.5 h-1.5 rounded-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,1)] animate-pulse"></span>
                    Evolución de Eficiencia Global (OEE)
                </h3>
                <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest mt-1">Sincronización histórica en tiempo real</p>
            </div>
            <div class="text-right">
                <span class="block text-4xl font-black text-white font-tech tracking-tighter" id="avgOeeValue">--%</span>
                <span class="text-[9px] text-amber-400 font-black uppercase tracking-widest">PROMEDIO SECTORIAL</span>
            </div>
        </div>
        <div class="p-8 relative">
            <div id="chartOeeTrend" class="w-full h-[400px]"></div>
        </div>
    </div>

    <!-- INTELLIGENCE HUB -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Projection Card -->
        <div class="glass-card rounded-2xl p-6 border border-white/5 relative overflow-hidden group">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i class="fas fa-bullseye text-5xl text-white"></i>
            </div>
            <h4 class="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em] mb-4">Proyección Fin de Turno</h4>
            <div class="flex items-end gap-3">
                <span id="projectedValue" class="text-3xl font-black text-white font-tech tracking-tighter">--%</span>
                <div id="projectionTrend" class="mb-1 flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/10 text-emerald-500 text-[10px] font-black uppercase">
                    <i class="fas fa-caret-up"></i>
                    <span>Optimista</span>
                </div>
            </div>
            <p class="text-[9px] text-slate-400 font-bold mt-2 uppercase tracking-widest">Basado en ritmo operativo actual</p>
        </div>

        <!-- Goal Status Card -->
        <div class="glass-card rounded-2xl p-6 border border-white/5 relative overflow-hidden">
            <h4 class="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em] mb-4">Meta Estándar (85% OEE)</h4>
            <div class="w-full bg-white/10 h-2.5 rounded-full overflow-hidden mb-3 border border-white/5">
                <div id="goalProgressBar" class="h-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.5)] transition-all duration-1000" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-[10px] font-black uppercase tracking-widest">
                <span class="text-slate-400">Progreso</span>
                <span id="goalPercentText" class="text-amber-400">0%</span>
            </div>
        </div>

        <!-- Reliability Card -->
        <div class="glass-card rounded-2xl p-6 border border-white/5">
            <h4 class="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em] mb-4">Confiabilidad de Planta</h4>
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center text-blue-400">
                    <i class="fas fa-shield-alt text-xl"></i>
                </div>
                <div>
                    <span class="block text-lg font-black text-white font-tech">94.2<span class="text-xs text-slate-400 ml-1">SR</span></span>
                    <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">MTBF / MTTR Index</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MIDDLE BI GRID: Bottlenecks & Sector Comparison -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Bottlenecks -->
        <div class="glass-card rounded-2xl border border-white/5 shadow-2xl overflow-hidden flex flex-col">
            <div class="p-8 border-b border-white/5 bg-white/[0.02]">
                <h3 class="text-xs font-black text-slate-400 mb-1 uppercase tracking-[0.3em] flex items-center gap-3">
                    <span class="w-1.5 h-1.5 rounded-full bg-orange-500 shadow-[0_0_10px_rgba(249,115,22,1)]"></span>
                    Principales Cuellos de Botella
                </h3>
                <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest mt-1">Impacto acumulado por detenciones</p>
            </div>
            <div class="p-6">
                <div id="bottleneckContainer" class="space-y-4">
                    <!-- Dynamic Bottlenecks -->
                </div>
            </div>
        </div>

        <!-- Sector Performance (Radar) -->
        <div class="glass-card rounded-2xl border border-white/5 shadow-2xl overflow-hidden flex flex-col">
            <div class="p-8 border-b border-white/5 bg-white/[0.02]">
                <h3 class="text-xs font-black text-slate-400 mb-1 uppercase tracking-[0.3em] flex items-center gap-3">
                    <span class="w-1.5 h-1.5 rounded-full bg-blue-400 shadow-[0_0_10px_rgba(96,165,250,1)]"></span>
                    Desempeño por Sectores
                </h3>
                <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest mt-1">Comparativa de Eficiencia Inter-Sectores</p>
            </div>
            <div class="p-4 flex-1 flex items-center justify-center">
                 <div id="chartSectors" class="w-full h-[350px]"></div>
            </div>
        </div>
    </div>

    <!-- PREDICTIVE MAINTENANCE HUB -->
    <div class="glass-card rounded-2xl border border-white/5 shadow-2xl overflow-hidden mb-8">
        <div class="p-8 border-b border-white/5 bg-white/[0.02]">
            <h3 class="text-xs font-black text-slate-400 mb-1 uppercase tracking-[0.3em] flex items-center gap-3">
                <span class="w-1.5 h-1.5 rounded-full bg-rose-500 shadow-[0_0_10px_rgba(244,63,94,1)] animate-pulse"></span>
                Mantenimiento Predictivo & Health Check
            </h3>
            <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest mt-1">Estimación de vida útil basada en horas reales de uso</p>
        </div>
        <div class="p-8 grid grid-cols-1 lg:grid-cols-2 gap-10">
            <!-- Incident Heatmap -->
            <div>
                <h4 class="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em] mb-6">Heatmap de Averías (30 Días)</h4>
                <div id="chartHeatmap" class="w-full h-[300px]"></div>
                <div id="heatmapEmpty" class="hidden h-[300px] items-center justify-center text-slate-600 text-[10px] uppercase font-bold tracking-widest">
                    Sin incidencias registradas en el periodo
                </div>
            </div>
            
            <!-- Service Life Meters -->
            <div>
                <h4 class="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em] mb-6">Vida Útil del Cabezal / Service</h4>
                <div id="maintenanceMeters" class="space-y-6 max-h-[300px] overflow-y-auto pr-4 scrollbar-thin">
                    <!-- Dynamic Meters -->
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- Pareto Chart (Downtime) -->
        <div class="glass-card rounded-2xl border border-white/5 shadow-2xl overflow-hidden flex flex-col">
            <div class="p-8 border-b border-white/5 bg-white/[0.02]">
                <h3 class="text-xs font-black text-slate-500 mb-1 uppercase tracking-[0.3em] flex items-center gap-3">
                    <span class="w-1.5 h-1.5 rounded-full bg-rose-500 shadow-[0_0_10px_rgba(244,63,94,1)]"></span>
                    Pareto de Detenciones Críticas
                </h3>
                <p class="text-[9px] text-slate-600 font-bold uppercase tracking-widest mt-1">Distribución de Tiempos Perdidos (Hs / Min)</p>
            </div>
            <div class="p-8 flex-1 flex items-center justify-center relative">
                 <div id="chartPareto" class="w-full h-[350px]"></div>
                 <!-- Empty State if no data -->
                 <div id="paretoEmpty" class="absolute inset-0 hidden flex flex-col items-center justify-center text-slate-500">
                    <i class="fas fa-check-circle text-4xl mb-3 text-emerald-500 opacity-20"></i>
                    <p class="font-black text-[10px] uppercase tracking-widest tracking-widest">Optimización de planta detectada</p>
                 </div>
            </div>
        </div>

        <!-- Ranking Table (Operators) -->
        <div class="glass-card rounded-2xl border border-white/5 shadow-2xl overflow-hidden flex flex-col">
             <div class="p-8 border-b border-white/5 bg-white/[0.02] flex justify-between items-center">
                <div>
                    <h3 class="text-xs font-black text-slate-500 mb-1 uppercase tracking-[0.3em] flex items-center gap-3">
                        <span class="w-1.5 h-1.5 rounded-full bg-blue-400 shadow-[0_0_10px_rgba(96,165,250,1)]"></span>
                        Ranking de Productividad
                    </h3>
                    <p class="text-[9px] text-slate-600 font-bold uppercase tracking-widest mt-1">Liderazgo y performance operativa</p>
                </div>
                 <div class="w-12 h-12 rounded-2xl bg-amber-400/10 border border-amber-400/20 flex items-center justify-center text-amber-400 shadow-inner">
                    <i class="fas fa-trophy text-xl"></i>
                 </div>
            </div>
            <div class="overflow-y-auto max-h-[400px]">
                <table class="w-full">
                    <thead class="bg-white/[0.03] sticky top-0 z-10 border-b border-white/5">
                        <tr class="text-left text-[9px] uppercase tracking-[0.2em] text-slate-500 font-black">
                            <th class="px-8 py-5">#</th>
                            <th class="px-8 py-5">Operario</th>
                            <th class="px-8 py-5 text-center">Eficiencia</th>
                            <th class="px-8 py-5 text-right">Volumen</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5">
                        {% for op in ranking_data %}
                        <tr class="hover:bg-white/[0.02] transition-all group border-b border-white/5 last:border-0">
                             <td class="px-8 py-5 font-mono text-slate-600 font-black text-[11px]">
                                {% if forloop.counter == 1 %}
                                    <i class="fas fa-medal text-amber-400 text-xl shadow-[0_0_15px_rgba(251,191,36,0.3)]"></i>
                                {% elif forloop.counter == 2 %}
                                    <i class="fas fa-medal text-slate-400 text-xl"></i>
                                {% elif forloop.counter == 3 %}
                                    <i class="fas fa-medal text-amber-900 text-xl"></i>
                                {% else %}
                                    {{ forloop.counter }}
                                {% endif %}
                             </td>
                             <td class="px-8 py-5">
                                <div class="font-black text-white group-hover:text-amber-400 transition-colors uppercase text-sm tracking-tighter">{{ op.name }}</div>
                                <div class="text-[9px] text-slate-600 font-tech font-bold tracking-widest uppercase">{{ op.legajo }}</div>
                             </td>
                             <td class="px-8 py-5 text-center">
                                <span class="px-4 py-1.5 rounded-xl text-[10px] font-black tracking-widest font-tech {% if op.oee >= 85 %}bg-emerald-400/10 text-emerald-400 border border-emerald-400/20{% elif op.oee >= 60 %}bg-amber-400/10 text-amber-400 border border-amber-400/20{% else %}bg-rose-400/10 text-rose-400 border border-rose-400/20{% endif %}">
                                    {{ op.oee }}%
                                </span>
                             </td>
                             <td class="px-8 py-5 text-right">
                                <span class="font-tech text-white font-black text-sm tracking-tighter">{{ op.total_qty|floatformat:0 }}</span>
                                <span class="text-[9px] text-slate-600 block font-black uppercase tracking-widest">unidades</span>
                             </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="px-8 py-20 text-center text-slate-600 text-[10px] font-black uppercase tracking-[0.2em] italic">
                                Sincronizando historial de producción...
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>


<!-- Loading Overlay -->
<div id="loadingOverlay" class="fixed inset-0 bg-[#020617]/95 backdrop-blur-xl z-[100] flex flex-col items-center justify-center transition-all duration-500">
    <div class="relative">
        <!-- Modern Spinner -->
        <div class="w-24 h-24 border-2 border-white/5 border-t-amber-400 rounded-full animate-spin"></div>
        <!-- Pulsing Center -->
        <div class="absolute inset-0 flex items-center justify-center">
             <div class="w-12 h-12 bg-amber-400/10 rounded-full flex items-center justify-center animate-pulse">
                <i class="fas fa-microchip text-amber-400"></i>
             </div>
        </div>
    </div>
    <div class="mt-8 text-center">
        <h3 class="text-xs font-black text-white uppercase tracking-[0.5em] animate-pulse">Procesando Análisis Gold</h3>
        <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-2">Sincronización de datos históricos...</p>
    </div>
</div>

<!-- Chart Data JSON -->
<script id="analytics-data" type="application/json">{{ chart_json|safe }}</script>

<!-- ApexCharts CDN -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const loadingOverlay = document.getElementById('loadingOverlay');
    
    // Hide loader immediately since we are serving SSR but we might want to keep it if we had async data.
    // However, since the user complained about delay BETWEEN page loads (when clicking 15 days),
    // we need to show it WHEN submitting the form.
    
    // Fade out on initial load
    setTimeout(() => {
        loadingOverlay.classList.add('opacity-0', 'pointer-events-none');
    }, 300); // Small delay for smoothness

    // Re-show loader on form submit
    const filterForm = document.querySelector('form');
    if(filterForm) {
        filterForm.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', function() {
                loadingOverlay.classList.remove('opacity-0', 'pointer-events-none');
            });
        });
    }

    // Full Screen Toggle
    const btnFs = document.getElementById('btnFullScreen');
    if(btnFs) {
        btnFs.addEventListener('click', () => {
             if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                btnFs.innerHTML = '<i class="fas fa-compress"></i><span class="hidden sm:inline">Salir</span>';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    btnFs.innerHTML = '<i class="fas fa-expand"></i><span class="hidden sm:inline">Modo TV</span>';
                }
            }
        });
    }

    const chartData = JSON.parse(document.getElementById('analytics-data').textContent);
    
    // --- 1. OEE TREND CHART ---
    if (chartData.trend && chartData.trend.length > 0) {
        const totalOee = chartData.trend.reduce((acc, curr) => acc + curr.oee, 0);
        const avgOee = (totalOee / chartData.trend.length).toFixed(1);
        document.getElementById('avgOeeValue').textContent = avgOee + '%';

        const optionsOee = {
            series: [{ name: 'OEE Global', data: chartData.trend.map(d => d.oee) }],
            chart: { type: 'area', height: 400, background: 'transparent', toolbar: { show: false }, fontFamily: 'JetBrains Mono' },
            colors: ['#fbbf24'],
            fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.6, opacityTo: 0.05, stops: [0, 100] } },
            stroke: { curve: 'smooth', width: 4 },
            xaxis: { categories: chartData.trend.map(d => d.date), labels: { style: { colors: '#94a3b8', fontWeight: 700 } } },
            yaxis: { min: 0, max: 110, labels: { style: { colors: '#94a3b8', fontWeight: 700 }, formatter: v => v.toFixed(0) + "%" } },
            grid: { borderColor: 'rgba(255,255,255,0.05)', strokeDashArray: 8 },
            theme: { mode: 'dark' }
        };
        new ApexCharts(document.querySelector("#chartOeeTrend"), optionsOee).render();
    }

    // --- 2. PARETO CHART ---
    if (chartData.pareto && chartData.pareto.labels && chartData.pareto.labels.length > 0) {
        const optionsPareto = {
            series: [
                { name: 'Minutos Perdidos', type: 'column', data: chartData.pareto.values },
                { name: 'Acumulado %', type: 'line', data: chartData.pareto.cumulative }
            ],
            chart: { height: 350, type: 'line', toolbar: { show: false }, fontFamily: 'JetBrains Mono' },
            stroke: { width: [0, 4], curve: 'smooth' },
            colors: ['#3b82f6', '#f59e0b', '#10b981', '#f43f5e', '#8b5cf6'],
            labels: chartData.pareto.labels,
            yaxis: [
                { title: { text: 'MINUTOS', style: { color: '#94a3b8' } }, labels: { style: { colors: '#94a3b8' } } },
                { opposite: true, title: { text: 'ACUMULADO %', style: { color: '#94a3b8' } }, min: 0, max: 105, labels: { style: { colors: '#94a3b8' } } }
            ],
            theme: { mode: 'dark' },
            legend: { show: false }
        };
        new ApexCharts(document.querySelector("#chartPareto"), optionsPareto).render();
    } else {
        document.getElementById('chartPareto').style.display = 'none';
        document.getElementById('paretoEmpty').classList.replace('hidden', 'flex');
    }

    // --- 3. BI INTELLIGENCE (Projection & Goals) ---
    if (chartData.projection) {
        document.getElementById('projectedValue').textContent = chartData.projection.projected + '%';
        const progress = Math.min(100, (chartData.projection.current / 85) * 100);
        setTimeout(() => {
            document.getElementById('goalProgressBar').style.width = progress + '%';
            document.getElementById('goalPercentText').textContent = Math.round(progress) + '%';
        }, 500);
        
        const trendEl = document.getElementById('projectionTrend');
        if (chartData.projection.trend === 'down') {
            trendEl.className = "mb-1 flex items-center gap-1 px-1.5 py-0.5 rounded bg-rose-500/10 text-rose-500 text-[10px] font-black uppercase";
            trendEl.innerHTML = '<i class="fas fa-caret-down"></i><span>Decreciente</span>';
        } else if (chartData.projection.trend === 'stable') {
            trendEl.className = "mb-1 flex items-center gap-1 px-1.5 py-0.5 rounded bg-blue-500/10 text-blue-500 text-[10px] font-black uppercase";
            trendEl.innerHTML = '<i class="fas fa-minus"></i><span>Estable</span>';
        }
    }

    // --- 4. BOTTLENECKS ---
    if (chartData.bottlenecks && chartData.bottlenecks.length > 0) {
        document.getElementById('bottleneckContainer').innerHTML = chartData.bottlenecks.map(m => `
            <div class="p-4 rounded-xl bg-white/[0.02] border border-white/5 hover:bg-white/[0.04] transition-all">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[11px] font-black text-white uppercase tracking-tighter">${m.name}</span>
                    <span class="text-[9px] font-tech font-bold text-rose-400">${m.lost_mins} Min Perdidos</span>
                </div>
                <div class="w-full bg-white/5 h-1.5 rounded-full overflow-hidden">
                    <div class="h-full bg-rose-500" style="width: ${m.impact}%"></div>
                </div>
                <div class="flex justify-between mt-2 text-[8px] font-black uppercase tracking-widest text-slate-600">
                    <span>Impacto Operativo</span>
                    <span>${m.impact}%</span>
                </div>
            </div>
        `).join('');
    }

    // --- 5. SECTOR RADAR ---
    if (chartData.sector_ranking && chartData.sector_ranking.length > 0) {
        const optionsSector = {
            series: [{ name: 'Eficiencia %', data: chartData.sector_ranking.map(s => s.efficiency) }],
            chart: { height: 350, type: 'radar', toolbar: { show: false }, background: 'transparent', fontFamily: 'JetBrains Mono' },
            colors: ['#fbbf24'],
            labels: chartData.sector_ranking.map(s => s.sector),
            xaxis: { labels: { style: { colors: '#94a3b8', fontSize: '9px', fontWeight: 800 } } },
            yaxis: { show: false, min: 0, max: 100 },
            theme: { mode: 'dark' }
        };
        new ApexCharts(document.querySelector("#chartSectors"), optionsSector).render();
    }

    // --- 6. INCIDENT HEATMAP ---
    if (chartData.heatmap && chartData.heatmap.length > 0) {
        const optionsHeatmap = {
            series: chartData.heatmap,
            chart: {
                height: 300,
                type: 'heatmap',
                toolbar: { show: false },
                background: 'transparent',
                fontFamily: 'JetBrains Mono'
            },
            dataLabels: { enabled: false },
            colors: ["#f43f5e"],
            plotOptions: {
                heatmap: {
                    shadeIntensity: 0.5,
                    radius: 4,
                    useFillColorAsStroke: true,
                    colorScale: {
                        ranges: [
                            { from: 1, to: 2, name: 'Bajo', color: '#fb7185' },
                            { from: 3, to: 5, name: 'Medio', color: '#e11d48' },
                            { from: 6, to: 100, name: 'Crítico', color: '#9f1239' }
                        ]
                    }
                }
            },
            xaxis: {
                labels: { style: { colors: '#94a3b8', fontSize: '10px' } }
            },
            theme: { mode: 'dark' }
        };
        new ApexCharts(document.querySelector("#chartHeatmap"), optionsHeatmap).render();
    } else {
        document.getElementById('chartHeatmap').classList.add('hidden');
        document.getElementById('heatmapEmpty').classList.replace('hidden', 'flex');
    }

    // --- 7. SERVICE LIFE METERS ---
    if (chartData.maintenance && chartData.maintenance.length > 0) {
        const container = document.getElementById('maintenanceMeters');
        container.innerHTML = chartData.maintenance.map(m => `
            <div class="group">
                <div class="flex justify-between items-center mb-1.5">
                    <span class="text-[10px] font-black text-white uppercase tracking-tighter">${m.name}</span>
                    <span class="text-[9px] font-tech font-bold ${m.progreso > 80 ? 'text-rose-400' : 'text-amber-400'}">
                        ${m.horas_uso} / ${m.frecuencia} hs
                    </span>
                </div>
                <div class="w-full bg-white/5 h-2 rounded-full overflow-hidden border border-white/5 shadow-inner">
                    <div class="h-full bg-gradient-to-r ${m.progreso > 80 ? 'from-rose-600 to-rose-400' : 'from-amber-600 to-amber-400'} shadow-[0_0_10px_rgba(251,191,36,0.3)] transition-all duration-1000" 
                         style="width: ${m.progreso}%"></div>
                </div>
                <div class="flex justify-between mt-1 text-[7px] font-black uppercase tracking-widest text-slate-500">
                    <span>Desgaste Acumulado</span>
                    <span>${m.progreso}%</span>
                </div>
            </div>
        `).join('');
    }
});
</script>
{% endblock %}
